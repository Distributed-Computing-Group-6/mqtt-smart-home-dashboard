
  <div class="flex-fill card flex-shrink-1" 
  [ngClass]="{'dash-card': isCard, 'page': !isCard,}">
  <div class="card-header pb-0">
    <div class="d-flex align-items-center justify-content-between">
      <h4 class="card-title mb-0">
        <a [routerLink]="['/device', device.ieee]" class="text-decoration-none text-dark">
          {{ device.friendly_name }}
        </a>
      </h4>
      <div *ngIf="!isCard" class="btn-group btn-group-sm">
        <button class="btn btn-secondary" (click)="openRenameModal()"><i class="bi bi-pencil"></i></button>
        <button class="btn btn-danger" (click)="openDeleteModal()"><i class="bi bi-trash3"></i></button>
      </div>
    </div>
  </div>    
    <div class="row card-body justify-content-center">
      <ng-container *ngFor="let control of device.controls" [ngSwitch]="control.type">
        
        <ng-container *ngSwitchCase="'binary'">
            <app-binary [topic]="topic" [control]="control" [isCard]="isCard"></app-binary>
        </ng-container>

        <ng-container *ngSwitchCase="'numeric'">
          <ng-container *ngIf="control.name !== 'color_temp_startup' || !isCard">
              <app-numeric [topic]="topic" [control]="control" [isCard]="isCard"></app-numeric>
          </ng-container>
        </ng-container>

        <ng-container *ngSwitchCase="'enum'">
              <app-enum [topic]="topic" [control]="control" [isCard]="isCard"></app-enum>
        </ng-container>

        <ng-container *ngSwitchCase="'composite'">
          <ng-container *ngIf="control.name == 'color_xy'; else elseTemplate">
            <app-color [topic]="topic" [control]="control" [isCard]="isCard"></app-color>
          </ng-container>
          <ng-template #elseTemplate>
            <app-composite [topic]="topic" [control]="control" [isCard]="isCard"></app-composite>
          </ng-template>
        </ng-container>

        <ng-container *ngSwitchDefault></ng-container>

      </ng-container>
      
      <ng-content></ng-content>
      
    </div>
  </div>

<!-- Modal -->
<ng-template #renameModalContent let-modal>
  <div class="modal-header">
    <h5 class="modal-title" id="renameModalLabel">Rename {{ device.friendly_name }}</h5>
    <button type="button" class="btn-close" (click)="closeModal()" aria-label="Close"></button>
  </div>
  <div class="modal-body">
    <form #editForm="ngForm" class="row g-3" (submit)="editName($event, newNameInput.value)">
      <label for="newName" class="col-sm-4 col-form-label">New Name</label>
      <div class="col-sm-8">
        <input 
          type="text" 
          class="form-control" 
          id="newName" 
          #newNameInput
          placeholder="{{ device.friendly_name }}"
          required      
          [ngClass]="{'is-invalid': isInvalid, 'is-valid': !isInvalid}">

          <div *ngIf="isInvalid" class="invalid-feedback">
            {{invalidMessage}}
          </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" #editModalClose (click)="closeModal()">Close</button>
        <button type="submit" class="btn btn-primary" [disabled]="editForm.invalid">Save changes</button>
      </div>
    </form>
  </div>
</ng-template>

<!-- Modal -->
<ng-template #deleteModalContent let-modal>
  <div class="modal-header">
    <h5 class="modal-title" id="deleteModalLabel">Delete {{ device.friendly_name }}</h5>
    <button type="button" class="btn-close" (click)="closeModal()" aria-label="Close"></button>
  </div>
  <div *ngIf="cantRemove" class="modal-body d-flex align-items-center is-invalid">
    <i class="bi bi-x-circle me-2 text-danger"></i>
    <span class="text-danger">{{ invalidMessage }}</span>
  </div>
  <div *ngIf="deleting" class="modal-body d-flex align-items-center">
    <span class="me-2">üóëÔ∏è Deleting...</span>
    <div class="spinner-border spinner-border-sm text-primary" role="status"></div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="closeModal()">Close</button>
    <button type="button" (click)="deleteDevice()" class="btn btn-danger">
      {{ !cantRemove ? "Confirm Delete" : "Force Delete" }}
    </button>
  </div>
</ng-template>
